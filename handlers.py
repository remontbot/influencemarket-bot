import logging
import re
import asyncio
import html
from datetime import datetime, timedelta
from telegram import (
    Update,
    InlineKeyboardButton,
    InlineKeyboardMarkup,
    ReplyKeyboardRemove,
    InputMediaPhoto,
)
from telegram.ext import (
    ContextTypes,
    ConversationHandler,
    MessageHandler,
    CallbackQueryHandler,
    filters,
)

import db

logger = logging.getLogger(__name__)


# ===== BELARUS REGIONS AND CITIES =====
#
# –õ–û–ì–ò–ö–ê "–î–†–£–ì–û–ô –ì–û–†–û–î":
# - –í –∫–∞–∂–¥–æ–º —Ä–µ–≥–∏–æ–Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–ø—Ü–∏—è "üìç –î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥ –≤ –æ–±–ª–∞—Å—Ç–∏"
# - –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –≥–æ—Ä–æ–¥, –Ω–µ –≤—Ö–æ–¥—è—â–∏–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫
# - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
#   1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–ª–æ–≥–µ—Ä–∞: –±–ª–æ–≥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ
#   2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞: –≥–æ—Ä–æ–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
#   3. –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏—è–∞: –∫–∞–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ
# - –ë–ª–æ–≥–µ—Ä–∞ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–∞–º–ø–∞–Ω–∏—è–∞—Ö –∏–∑ —Å–≤–æ–∏—Ö –≥–æ—Ä–æ–¥–æ–≤
# - –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –±–ª–æ–≥–µ—Ä–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≥–æ—Ä–æ–¥–æ–º –∫–∞–º–ø–∞–Ω–∏—è–∞ - –±–ª–æ–≥–µ—Ä –≤–∏–¥–∏—Ç –∫–∞–º–ø–∞–Ω–∏—è
# - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –≥–æ—Ä–æ–¥–æ–≤, –ø–æ—Å—ë–ª–∫–æ–≤ –∏ –∞–≥—Ä–æ–≥–æ—Ä–æ–¥–∫–æ–≤
#

BELARUS_REGIONS = {
    "–ú–∏–Ω—Å–∫": {
        "type": "city",  # –ú–∏–Ω—Å–∫ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥, –Ω–µ —á–∞—Å—Ç—å –ú–∏–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏
        "display": "üèõ –ú–∏–Ω—Å–∫"
    },
    "–ë—Ä–µ—Å—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": {
        "type": "region",
        "display": "üåæ –ë—Ä–µ—Å—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "cities": ["–ë—Ä–µ—Å—Ç", "–ë–∞—Ä–∞–Ω–æ–≤–∏—á–∏", "–ü–∏–Ω—Å–∫", "–ö–æ–±—Ä–∏–Ω", "–ë–µ—Ä—ë–∑–∞", "–ò–≤–∞—Ü–µ–≤–∏—á–∏", "–õ—É–Ω–∏–Ω–µ—Ü", "–ü—Ä—É–∂–∞–Ω—ã", "–°—Ç–æ–ª–∏–Ω", "–ú–∞–ª–æ—Ä–∏—Ç–∞", "–ñ–∞–±–∏–Ω–∫–∞"]
    },
    "–í–∏—Ç–µ–±—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": {
        "type": "region",
        "display": "üå≤ –í–∏—Ç–µ–±—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "cities": ["–í–∏—Ç–µ–±—Å–∫", "–û—Ä—à–∞", "–ù–æ–≤–æ–ø–æ–ª–æ—Ü–∫", "–ü–æ–ª–æ—Ü–∫", "–ì–ª—É–±–æ–∫–æ–µ", "–õ–µ–ø–µ–ª—å", "–ü–æ—Å—Ç–∞–≤—ã", "–°–µ–Ω–Ω–æ", "–¢–æ–ª–æ—á–∏–Ω", "–ß–∞—à–Ω–∏–∫–∏"]
    },
    "–ì–æ–º–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": {
        "type": "region",
        "display": "üè≠ –ì–æ–º–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "cities": ["–ì–æ–º–µ–ª—å", "–ú–æ–∑—ã—Ä—å", "–ñ–ª–æ–±–∏–Ω", "–°–≤–µ—Ç–ª–æ–≥–æ—Ä—Å–∫", "–†–µ—á–∏—Ü–∞", "–ö–∞–ª–∏–Ω–∫–æ–≤–∏—á–∏", "–†–æ–≥–∞—á—ë–≤", "–î–æ–±—Ä—É—à", "–ñ–∏—Ç–∫–æ–≤–∏—á–∏", "–ü–µ—Ç—Ä–∏–∫–æ–≤", "–•–æ–π–Ω–∏–∫–∏"]
    },
    "–ì—Ä–æ–¥–Ω–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": {
        "type": "region",
        "display": "üè∞ –ì—Ä–æ–¥–Ω–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "cities": ["–ì—Ä–æ–¥–Ω–æ", "–õ–∏–¥–∞", "–°–ª–æ–Ω–∏–º", "–í–æ–ª–∫–æ–≤—ã—Å–∫", "–ù–æ–≤–æ–≥—Ä—É–¥–æ–∫", "–°–º–æ—Ä–≥–æ–Ω—å", "–©—É—á–∏–Ω", "–û—Å—Ç—Ä–æ–≤–µ—Ü", "–ë–µ—Ä—ë–∑–æ–≤–∫–∞", "–ò–≤—å–µ"]
    },
    "–ú–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": {
        "type": "region",
        "display": "üå≥ –ú–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "cities": ["–ë–æ—Ä–∏—Å–æ–≤", "–°–æ–ª–∏–≥–æ—Ä—Å–∫", "–ú–æ–ª–æ–¥–µ—á–Ω–æ", "–ñ–æ–¥–∏–Ω–æ", "–°–ª—É—Ü–∫", "–î–∑–µ—Ä–∂–∏–Ω—Å–∫", "–ú–∞—Ä—å–∏–Ω–∞ –ì–æ—Ä–∫–∞", "–í–∏–ª–µ–π–∫–∞", "–°—Ç–æ–ª–±—Ü—ã", "–ù–µ—Å–≤–∏–∂", "–ö–æ–ø—ã–ª—å", "–£–∑–¥–∞", "–õ–æ–≥–æ–π—Å–∫", "–°–º–æ–ª–µ–≤–∏—á–∏"]
    },
    "–ú–æ–≥–∏–ª—ë–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": {
        "type": "region",
        "display": "üåæ –ú–æ–≥–∏–ª—ë–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "cities": ["–ú–æ–≥–∏–ª—ë–≤", "–ë–æ–±—Ä—É–π—Å–∫", "–ì–æ—Ä–∫–∏", "–û—Å–∏–ø–æ–≤–∏—á–∏", "–ö—Ä–∏—á–µ–≤", "–®–∫–ª–æ–≤", "–ë—ã—Ö–æ–≤", "–ö–ª–∏–º–æ–≤–∏—á–∏", "–ß–∞—É—Å—ã", "–ß–µ—Ä–∏–∫–æ–≤"]
    },
    "–í—Å—è –ë–µ–ª–∞—Ä—É—Å—å": {
        "type": "country",
        "display": "üáßüáæ –í—Å—è –ë–µ–ª–∞—Ä—É—Å—å"
    }
}


# ===== BLOGGER TOPICS HIERARCHY =====
# –¢–µ–º–∞—Ç–∏–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –±–ª–æ–≥–µ—Ä–æ–≤

BLOGGER_TOPICS = {
    "fashion": {
        "name": "üëó –ú–æ–¥–∞ –∏ —Å—Ç–∏–ª—å",
        "emoji": "üëó",
        "subcategories": [
            "–ñ–µ–Ω—Å–∫–∞—è –º–æ–¥–∞",
            "–ú—É–∂—Å–∫–∞—è –º–æ–¥–∞",
            "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",
            "–û–±—Ä–∞–∑—ã (OOTD)",
            "–¢—Ä–µ–Ω–¥—ã –∏ —Å–æ–≤–µ—Ç—ã"
        ]
    },
    "beauty": {
        "name": "üíÑ –ö—Ä–∞—Å–æ—Ç–∞ –∏ —É—Ö–æ–¥",
        "emoji": "üíÑ",
        "subcategories": [
            "–ú–∞–∫–∏—è–∂ –∏ –∫–æ—Å–º–µ—Ç–∏–∫–∞",
            "–£—Ö–æ–¥ –∑–∞ –∫–æ–∂–µ–π",
            "–£—Ö–æ–¥ –∑–∞ –≤–æ–ª–æ—Å–∞–º–∏",
            "–ú–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä",
            "–ü–∞—Ä—Ñ—é–º–µ—Ä–∏—è"
        ]
    },
    "fitness": {
        "name": "üí™ –°–ø–æ—Ä—Ç –∏ —Ñ–∏—Ç–Ω–µ—Å",
        "emoji": "üí™",
        "subcategories": [
            "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è",
            "–ü–∏—Ç–∞–Ω–∏–µ –∏ –¥–∏–µ—Ç—ã",
            "–ô–æ–≥–∞ –∏ —Ä–∞—Å—Ç—è–∂–∫–∞",
            "–ú–æ—Ç–∏–≤–∞—Ü–∏—è",
            "–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ"
        ]
    },
    "food": {
        "name": "üçï –ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è",
        "emoji": "üçï",
        "subcategories": [
            "–†–µ—Ü–µ–ø—Ç—ã",
            "–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ",
            "–ü–ü –∏ –ó–û–ñ",
            "–í—ã–ø–µ—á–∫–∞ –∏ –¥–µ—Å–µ—Ä—Ç—ã",
            "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É—Ö–Ω—è"
        ]
    },
    "travel": {
        "name": "‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è",
        "emoji": "‚úàÔ∏è",
        "subcategories": [
            "–û—Ç–¥—ã—Ö –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π",
            "–¢—É—Ä–∏–∑–º –ø–æ –ë–µ–ª–∞—Ä—É—Å–∏",
            "–û—Ç–µ–ª–∏ –∏ –∂–∏–ª—å—ë",
            "–°–æ–≤–µ—Ç—ã –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º",
            "–ë—é–¥–∂–µ—Ç–Ω—ã–µ –ø–æ–µ–∑–¥–∫–∏"
        ]
    },
    "tech": {
        "name": "üì± –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "emoji": "üì±",
        "subcategories": [
            "–ì–∞–¥–∂–µ—Ç—ã –∏ –æ–±–∑–æ—Ä—ã",
            "–ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
            "–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –ü–û",
            "–ò–≥—Ä–æ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",
            "–ù–æ–≤–∏–Ω–∫–∏ —Ç–µ—Ö–Ω–∏–∫–∏"
        ]
    },
    "education": {
        "name": "üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
        "emoji": "üìö",
        "subcategories": [
            "–Ø–∑—ã–∫–∏",
            "–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ",
            "–û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã",
            "–õ–∞–π—Ñ—Ö–∞–∫–∏ –¥–ª—è —É—á—ë–±—ã",
            "–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ –∫–∞—Ä—å–µ—Ä–∞"
        ]
    },
    "business": {
        "name": "üíº –ë–∏–∑–Ω–µ—Å –∏ —Ñ–∏–Ω–∞–Ω—Å—ã",
        "emoji": "üíº",
        "subcategories": [
            "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ",
            "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏",
            "–õ–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã",
            "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",
            "–ü—Ä–æ–¥–∞–∂–∏"
        ]
    },
    "entertainment": {
        "name": "üé¨ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
        "emoji": "üé¨",
        "subcategories": [
            "–ö–∏–Ω–æ –∏ —Å–µ—Ä–∏–∞–ª—ã",
            "–ú—É–∑—ã–∫–∞",
            "–ö–Ω–∏–≥–∏",
            "–Æ–º–æ—Ä –∏ –º–µ–º—ã",
            "–ß–µ–ª–ª–µ–Ω–¥–∂–∏"
        ]
    },
    "gaming": {
        "name": "üéÆ –ò–≥—Ä—ã",
        "emoji": "üéÆ",
        "subcategories": [
            "–ú–æ–±–∏–ª—å–Ω—ã–µ –∏–≥—Ä—ã",
            "–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∏–≥—Ä—ã",
            "–ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã",
            "–ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç",
            "–û–±–∑–æ—Ä—ã –∏–≥—Ä"
        ]
    },
    "family": {
        "name": "üë®‚Äçüë©‚Äçüëß –°–µ–º—å—è –∏ –¥–µ—Ç–∏",
        "emoji": "üë®‚Äçüë©‚Äçüëß",
        "subcategories": [
            "–ú–∞—Ç–µ—Ä–∏–Ω—Å—Ç–≤–æ",
            "–í–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –¥–µ—Ç–µ–π",
            "–î–µ—Ç—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã",
            "–°–µ–º–µ–π–Ω—ã–π –¥–æ—Å—É–≥",
            "–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å"
        ]
    },
    "pets": {
        "name": "üêæ –ñ–∏–≤–æ—Ç–Ω—ã–µ",
        "emoji": "üêæ",
        "subcategories": [
            "–°–æ–±–∞–∫–∏",
            "–ö–æ—à–∫–∏",
            "–î—Ä—É–≥–∏–µ –ø–∏—Ç–æ–º—Ü—ã",
            "–£—Ö–æ–¥ –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã–º–∏",
            "–î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∞"
        ]
    },
    "auto": {
        "name": "üöó –ê–≤—Ç–æ –∏ –º–æ—Ç–æ",
        "emoji": "üöó",
        "subcategories": [
            "–û–±–∑–æ—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π",
            "–¢—é–Ω–∏–Ω–≥",
            "–†–µ–º–æ–Ω—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
            "–ú–æ—Ç–æ—Ü–∏–∫–ª—ã",
            "–ê–≤—Ç–æ–Ω–æ–≤–æ—Å—Ç–∏"
        ]
    }
}


